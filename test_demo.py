import matplotlib.pyplot as plt

class PointD:
    def __init__(self, nx=0.0, ny=0.0):
        if isinstance(nx, PointD):
            self.x = nx.x
            self.y = nx.y
        else:
            self.x = nx
            self.y = ny

    def __add__(self, other):
        if isinstance(other, PointD):
            return PointD(self.x + other.x, self.y + other.y)
        elif isinstance(other, (int, float)):
            return PointD(self.x + other, self.y + other)

    def __radd__(self, other):
        return self + other

    def __sub__(self, other):
        if isinstance(other, PointD):
            return PointD(self.x - other.x, self.y - other.y)
        elif isinstance(other, (int, float)):
            return PointD(self.x - other, self.y - other)

    def __rsub__(self, other):
        return self - other

    def __mul__(self, other):
        if isinstance(other, PointD):
            return PointD(self.x * other.x, self.y * other.y)
        elif isinstance(other, (int, float)):
            return PointD(self.x * other, self.y * other)

    def __rmul__(self, other):
        return self * other

    def __truediv__(self, other):
        if isinstance(other, PointD):
            return PointD(self.x / other.x, self.y / other.y)
        elif isinstance(other, (int, float)):
            return PointD(self.x / other, self.y / other)

    def __rtruediv__(self, other):
        if isinstance(other, (int, float)):
            return PointD(other / self.x, other / self.y)

    def __neg__(self):
        return PointD(-self.x, -self.y)

def get_curve_smoothing_chaikin(points, tension, nr_of_iterations):
    if points is None or len(points) < 3:
        return None

    nr_of_iterations = min(max(nr_of_iterations, 1), 10)
    tension = min(max(tension, 0), 1)

    cutdist = 0.05 + (tension * 0.4)

    nl = [PointD(p) for p in points]

    for _ in range(nr_of_iterations):
        nl = get_smoother_chaikin(nl, cutdist)

    return nl


def get_smoother_chaikin(points, cutting_dist):
    nl = [PointD(points[0])]

    for i in range(len(points) - 1):
        q = (1 - cutting_dist) * points[i] + cutting_dist * points[i + 1]
        r = cutting_dist * points[i] + (1 - cutting_dist) * points[i + 1]
        nl.extend([q, r])

    nl.append(PointD(points[-1]))

    return nl

def get_spline_interpolation_catmull_rom(points, nr_of_interpolated_points):
    try:
        # The Catmull-Rom Spline requires at least 3 points
        if len(points) < 3:
            raise Exception("Catmull-Rom Spline requires at least 3 points")

        # Ensure nr_of_interpolated_points is valid
        nr_of_interpolated_points = max(nr_of_interpolated_points, 1)

        # Copy points to avoid modifying the original list
        spoints = [PointD(p) for p in points]

        # Extrapolate the first and last point out
        dx = spoints[1].x - spoints[0].x
        dy = spoints[1].y - spoints[0].y
        spoints.insert(0, PointD(spoints[0].x - dx, spoints[0].y - dy))

        dx = spoints[-1].x - spoints[-2].x
        dy = spoints[-1].y - spoints[-2].y
        spoints.append(PointD(spoints[-1].x + dx, spoints[-1].y + dy))

        spline = []

        for i in range(len(spoints) - 3):
            for intp in range(nr_of_interpolated_points):
                t = 1 / nr_of_interpolated_points * intp
                spoint = 0.5 * (
                    2 * spoints[i + 1] +
                    (-1 * spoints[i] + spoints[i + 2]) * t +
                    (2 * spoints[i] - 5 * spoints[i + 1] + 4 * spoints[i + 2] - spoints[i + 3]) * (t ** 2) +
                    (1 * spoints[i] + 3 * spoints[i + 1] - 3 * spoints[i + 2] + spoints[i + 3]) * (t ** 3)
                )
                spline.append(PointD(spoint))

        # Add the second last point of spoints to the spline
        spline.append(spoints[-2])

        return spline

    except Exception as exc:
        # In case of an exception, you can print or log the exception details if needed
        # print(exc)
        return None

# Prepare the data
#  x = [39.3306, 34.9779, 30.5759, 26.1566, 21.7149, 17.4119, 13.2003, 9.04152, 5.01368, 1.12994, -2.69895, -6.47047, -10.0587, -13.0821, -15.9667, -19.4121, -22.9548, -27.7645, -29.9855, -31.115, -31.9057, -33.7512, -33.9321]
#  y = [-268.265, -264.813, -261.802, -259.142, -256.709, -254.465, -252.263, -249.979, -247.565, -244.96, -242.043, -238.752, -235.165, -231.748, -228.112, -223.241, -217.574, -208.697, -204.099, -201.952, -199.981, -195.347, -194.855]
#  x = [92.566600, 91.868049, 91.119930, 90.384539, 89.595974, 88.779760, 87.954355, 87.112544, 86.269248, 85.420650, 84.576859, 83.733988, 82.899885, 82.085439, 81.291712, 80.519056, 79.759623, 79.003373, 78.248678, 77.484719, 76.720125, 75.952773, 75.176864, 74.401239, 73.622714, 72.846382, 72.071251, 71.305808, 70.546022, 69.791327, 69.045612, 68.306544, 67.573416, 66.845096, 66.127948, 65.420700, 64.714371, 64.022608, 63.333816, 62.654074, 61.982040, 61.321107, 60.664770, 60.020172, 59.380028, 58.749996, 58.119822, 57.418373, 56.810897, 56.020988, 55.246918, 54.482394, 53.735124, 53.007087, 52.290222, 51.591106, 50.900262, 50.230561, 49.569204, 48.929909, 48.297473, 47.681795, 47.075380, 46.341474, 45.624892, 44.924644, 44.246812, 43.583404, 42.937745, 42.306086, 41.690267, 41.085479, 40.378018, 39.685619, 39.010474, 38.345935, 37.693134, 37.047545, 36.407614, 35.773410, 35.140761, 34.509881, 33.877515, 33.253635, 32.648988, 32.071847, 31.512101, 30.961902, 30.405550, 29.881796, 29.390498, 28.888240, 28.377214, 27.841157, 27.274198, 26.682421, 26.055288, 25.395981, 24.783344, 24.216315, 23.640094, 23.044568, 22.428254, 21.798858, 21.158361, 20.501742, 19.825182, 19.138864, 18.438687, 17.722246, 16.992088, 16.247222, 15.581339, 14.903648, 14.324174, 13.727942, 13.133265, 12.525860, 11.914849, 11.285383, 10.665250, 10.015560, 9.372093, 8.738313, 8.078583, 7.413690, 6.740949, 6.056328, 5.374818, 4.670187, 3.961595, 3.241689, 2.511814, 1.773099, 1.024273, 0.272902, -0.484198, -1.251621, -2.025478, -2.798275, -3.575598, -4.364234, -5.148486, -5.938112, -6.734102, -7.533982, -8.335558, -9.142437, -9.959994, -10.783187, -11.615161, -12.454921, -13.287264, -14.128085, -14.977440, -15.823790, -16.667489, -17.522119, -18.230124, -19.082662, -19.934471, -20.792934, -21.645127, -22.500575, -23.353550, -24.217353, -25.074621, -25.915385, -26.766947, -27.618148, -28.461379, -29.309660, -30.153649, -30.990241, -31.829895, -32.661212, -33.487077, -34.316068, -35.153721, -35.954958, -36.760119, -37.566291, -38.367938, -39.160888, -39.954615, -40.733564, -41.516473, -42.285805, -43.052592, -43.807923, -44.558375, -45.297868, -46.032905, -46.755073, -47.477949, -48.175651, -48.873141, -49.568156, -50.251575, -50.925943, -51.596209, -52.252192, -52.905135, -53.544147, -54.178492, -54.803999, -55.424980, -56.032526, -56.622819, -57.214243, -57.987747, -58.738695, -59.476631, -60.198658, -60.900745, -61.587416, -62.258885, -62.918120, -63.556284, -64.182922, -64.795418, -65.392216, -65.973104, -66.544164, -67.170236, -67.844392, -68.505395, -69.143700, -69.764187, -70.368621, -70.961743, -71.536903, -72.099336, -72.707801, -73.350208, -73.980240, -74.597969, -75.205515, -75.805636, -76.396565, -76.982969, -77.564423, -78.146372, -78.729876, -79.311825, -79.901199, -80.494886, -81.097977, -81.707291, -82.327706, -82.911140, -83.500160, -84.047744, -84.605014, -85.176993, -85.755406, -86.349730, -86.955862, -87.573519, -88.210057, -88.788329, -89.313921, -89.847433, -90.386673, -90.939489, -91.502912, -92.078072, -92.660233, -93.257032, -93.863800, -94.481599, -95.114601, -95.757998, -96.410657, -96.915956, -97.502996, -98.017487, -98.540038, -99.065702, -99.599284, -100.125513, -100.652166, -101.188012, -101.723221, -102.261683, -102.805165, -103.350839, -103.896372, -104.443956, -104.993873, -105.544497, -106.097808, -106.651331, -107.204996, -107.760428, -108.311406, -108.864010, -109.422553, -109.978056, -110.532499, -111.091820, -111.644778, -112.198301, -112.755855, -113.311358, -113.863608, -114.423849, -114.968038, -115.431052, -115.982312, -116.529471, -117.079954, -117.624143, -118.167979, -118.711744, -119.262156, -119.727079, -120.262783, -120.822175, -121.371809, -121.914090, -122.437490, -122.949152, -123.447663, -123.942284, -124.432097, -124.913000, -125.388954, -125.852745, -126.313072, -126.760953, -127.202258, -127.632745, -128.052766, -128.463030, -128.869687, -129.271253, -129.671051, -130.073183, -130.477860, -130.889042, -131.304468, -131.710135, -132.120964, -132.523237, -132.917873, -133.295397, -133.664507, -134.027394, -134.384413, -134.727854, -135.065356, -135.395222, -135.719784, -136.033456, -136.337866, -136.626860, -136.903268, -137.162777, -137.408496, -137.646296, -137.874904, -138.098491, -138.315785, -138.526432, -138.732483, -138.932806, -139.126129, -139.309553, -139.487885, -139.658369, -139.847732, -140.053641, -140.244843, -140.424589, -140.594083, -140.754243, -140.907402, -141.054834, -141.196679, -141.333858, -141.467077, -141.597114, -141.724676, -141.863835, -142.015155, -142.162092, -142.306837, -142.447127, -142.585013, -142.719929, -142.852441, -142.982548, -143.110110, -143.260512, -143.408439, -143.553254, -143.697080, -143.839279, -143.979993, -144.119505, -144.259017, -144.398105, -144.537617, -144.677837, -144.818692, -144.960609, -145.104364, -145.250098, -145.398520, -145.549204, -145.702788, -145.833178, -145.964135, -146.096788, -146.231562, -146.366775, -146.502964, -146.640595, -146.778573, -146.917385, -147.028818, -147.141545, -147.254470, -147.369389, -147.485553, -147.603081, -147.722129, -147.843504, -147.966979, -148.092052, -148.219049, -148.348591, -148.479702, -148.611783, -148.714292, -148.819269, -148.928390, -149.039872, -149.152650, -149.266613, -149.381961, -149.498073, -149.612859, -149.728319, -149.842785, -149.957117, -150.070770, -150.184905, -150.298006, -150.411108, -150.523531, -150.636053, -150.747479, -150.859067, -150.969800, -151.080370, -151.190835, -151.301009, -151.411261, -151.521103, -151.632175, -151.742908, -151.853634, -151.964805, -152.075729, -152.186957, -152.298397, -152.410544, -152.521419, -152.633566, -152.745572, -152.859345, -152.971846, -153.086468, -153.201726, -153.318116, -153.435778, -153.553936, -153.673083, -153.794282, -153.915126, -154.038375, -154.161694, -154.286994, -154.413071, -154.539148, -154.666710, -154.795262, -154.923743, -155.052720, -155.181625, -155.310036, -155.436891, -155.564170, -155.690813, -155.816607, -155.942118, -156.065438, -156.188899, -156.310804, -156.431153, -156.550655, -156.668176, -156.784212, -156.897420, -157.009638, -157.117966, -157.225588, -157.329603, -157.432487, -157.532543, -157.630831, -157.725866, -157.819628, -157.910279, -157.999163, -158.085783, -158.170000, -158.251812, -158.331927, -158.409921, -158.485369, -158.559107, -158.630927, -158.700493, -158.768856, -158.834673, -158.899013, -158.961648, -159.023188, -159.083426, -159.161922, -159.240390, -159.320540, -159.398661, -159.477624, -159.557174, -159.634489, -159.712631, -159.788774, -159.864718, -159.938496, -160.011698, -160.082950, -160.152890, -160.238301, -160.321549, -160.402852, -160.481977, -160.558911, -160.634274, -160.707665, -160.779620, -160.849751, -160.932221, -161.013050, -161.092203, -161.169858, -161.246586, -161.322155, -161.397164 ]
#  y = [-310.922000, -310.940314, -310.975669, -311.019510, -311.072684, -311.130879, -311.179882, -311.212762, -311.230157, -311.238713, -311.233976, -311.190135, -311.082372, -310.899797, -310.648420, -310.346274, -310.021005, -309.698210, -309.396488, -309.119585, -308.856046, -308.623549, -308.436378, -308.298422, -308.202962, -308.139252, -308.096967, -308.069036, -308.051005, -308.039196, -308.032550, -308.029155, -308.028307, -308.028307, -308.029863, -308.031418, -308.033469, -308.035095, -308.036580, -308.037499, -308.037782, -308.036863, -308.035590, -308.033893, -308.030570, -308.027034, -308.022226, -308.016569, -308.010276, -308.002568, -307.995992, -307.992598, -307.991749, -307.994295, -307.999811, -308.007377, -308.017983, -308.031489, -308.046550, -308.063592, -308.082259, -308.102553, -308.124898, -308.154525, -308.186628, -308.220781, -308.257975, -308.297715, -308.340919, -308.387093, -308.435813, -308.487643, -308.553051, -308.623196, -308.697301, -308.776355, -308.859228, -308.946202, -309.037419, -309.134222, -309.235126, -309.341334, -309.461754, -309.635914, -309.884179, -310.205347, -310.581245, -310.987195, -311.409197, -311.802843, -312.159790, -312.530527, -312.905788, -313.276383, -313.635452, -313.974085, -314.295748, -314.600087, -314.856342, -315.076889, -315.288243, -315.494860, -315.699638, -315.901941, -316.102618, -316.305275, -316.510901, -316.719215, -316.930074, -317.145883, -317.365511, -317.588532, -317.789138, -317.994482, -318.173734, -318.364087, -318.558541, -318.758652, -318.962370, -319.174643, -319.384654, -319.605837, -319.826454, -320.043041, -320.268608, -320.495094, -320.723773, -320.953017, -321.176321, -321.394464, -321.599595, -321.794827, -321.978817, -322.154674, -322.327915, -322.500874, -322.675317, -322.853013, -323.034315, -323.215971, -323.399323, -323.588333, -323.781444, -323.984171, -324.196091, -324.413315, -324.626578, -324.823931, -325.003678, -325.163604, -325.306857, -325.439510, -325.564746, -325.687146, -325.806767, -325.921969, -326.031691, -326.139617, -326.225368, -326.325543, -326.422162, -326.522607, -326.623853, -326.715626, -326.792197, -326.859798, -326.920864, -326.975325, -327.025028, -327.070127, -327.108671, -327.140951, -327.164695, -327.179629, -327.186312, -327.183243, -327.170479, -327.148114, -327.116025, -327.075805, -327.028195, -326.974526, -326.916331, -326.856510, -326.800295, -326.750515, -326.704694, -326.663682, -326.620124, -326.565111, -326.493906, -326.406083, -326.302492, -326.187445, -326.064621, -325.943494, -325.819326, -325.694097, -325.568586, -325.442508, -325.315159, -325.187667, -325.058549, -324.929644, -324.798900, -324.666388, -324.532179, -324.400092, -324.267721, -324.129411, -323.939836, -323.747503, -323.550644, -323.350604, -323.149008, -322.944724, -322.737966, -322.528875, -322.319925, -322.109349, -321.898772, -321.689469, -321.482640, -321.275882, -321.046355, -320.795615, -320.545865, -320.301701, -320.060931, -319.823909, -319.588301, -319.357360, -319.129247, -318.879285, -318.612352, -318.347187, -318.083860, -317.821665, -317.559116, -317.297275, -317.033736, -316.769490, -316.501497, -316.229402, -315.954338, -315.672555, -315.385187, -315.090253, -314.788813, -314.477262, -314.179641, -313.874878, -313.586661, -313.288333, -312.976428, -312.655402, -312.319172, -311.969296, -311.605489, -311.222379, -310.867270, -310.538677, -310.199620, -309.852147, -309.491382, -309.120009, -308.737747, -308.348343, -307.946707, -307.536656, -307.117836, -306.687350, -306.248873, -305.802688, -305.456630, -305.057963, -304.709784, -304.355524, -303.993061, -303.613061, -303.225708, -302.828880, -302.417202, -301.999232, -301.571786, -301.133804, -300.686700, -300.232384, -299.768805, -299.294831, -298.811665, -298.317044, -297.812735, -297.298669, -296.773642, -296.244160, -295.704991, -295.151963, -294.597309, -294.037351, -293.462473, -292.885474, -292.300555, -291.704110, -291.102787, -290.498211, -289.877583, -289.267774, -288.743667, -288.112644, -287.478935, -286.834407, -286.190657, -285.542311, -284.889652, -284.226668, -283.670529, -283.036678, -282.381261, -281.728814, -281.059113, -280.380432, -279.685770, -278.989270, -278.284638, -277.575198, -276.866747, -276.151933, -275.440513, -274.718557, -273.998298, -273.270049, -272.540880, -271.811146, -271.084382, -270.351183, -269.618549, -268.891219, -268.171880, -267.460742, -266.750454, -266.042993, -265.358302, -264.667458, -263.980787, -263.289307, -262.609000, -261.925935, -261.239475, -260.551390, -259.879426, -259.208594, -258.541439, -257.871809, -257.211088, -256.551004, -255.896718, -255.239745, -254.588500, -253.939022, -253.288696, -252.650391, -252.016965, -251.392801, -250.776134, -250.163355, -249.553334, -248.950455, -248.363132, -247.774960, -247.195911, -246.528260, -245.771090, -245.033861, -244.306389, -243.591151, -242.891469, -242.203312, -241.526823, -240.865820, -240.219807, -239.587229, -238.966743, -238.356934, -237.690557, -236.966621, -236.265171, -235.576237, -234.910708, -234.258756, -233.624057, -233.002793, -232.395388, -231.802832, -231.107251, -230.426308, -229.762759, -229.107553, -228.461894, -227.825781, -227.196951, -226.569676, -225.944523, -225.318663, -224.689974, -224.057821, -223.421071, -222.775978, -222.121126, -221.453688, -220.773946, -220.076456, -219.479375, -218.874092, -218.252828, -217.612048, -216.958837, -216.288641, -215.597402, -214.888972, -214.160447, -213.564632, -212.952575, -212.331099, -211.691817, -211.039356, -210.373834, -209.695266, -209.000215, -208.289729, -207.567122, -206.829751, -206.073995, -205.304112, -204.523176, -203.921548, -203.320550, -202.705735, -202.082958, -201.454687, -200.818551, -200.171356, -199.513609, -198.855104, -198.182847, -197.506060, -196.819099, -196.125661, -195.420117, -194.711419, -193.993387, -193.270717, -192.537398, -191.800578, -191.051477, -190.298125, -189.537540, -188.769919, -187.998755, -187.221305, -186.442031, -185.649138, -184.854350, -184.055454, -183.249649, -182.442041, -181.628939, -180.810534, -179.984492, -179.163682, -178.331842, -177.500426, -176.657059, -175.825855, -174.982489, -174.139759, -173.293494, -172.444824, -171.598912, -170.752011, -169.898250, -169.053469, -168.199355, -167.351817, -166.498481, -165.646063, -164.801283, -163.953745, -163.104934, -162.260719, -161.416151, -160.574057, -159.735570, -158.906275, -158.073445, -157.244362, -156.418390, -155.591853, -154.778539, -153.961548, -153.152052, -152.348213, -151.545223, -150.747889, -149.953313, -149.169061, -148.382829, -147.613497, -146.839639, -146.081409, -145.320915, -144.570039, -143.822344, -143.087943, -142.352835, -141.631161, -140.912529, -140.201674, -139.500436, -138.807401, -138.118608, -137.437452, -136.767610, -136.103298, -135.445002, -134.798014, -134.152369, -133.521997, -132.898902, -132.286279, -131.678570, -131.077960, -130.295327, -129.525027, -128.757285, -128.026505, -127.303226, -126.587281, -125.900157, -125.214468, -124.551286, -123.894806, -123.260010, -122.632295, -122.022652, -121.425352, -120.696049, -119.985315, -119.291940, -118.616582, -117.960104, -117.317075, -116.690869, -116.076563, -115.478365, -114.775055, -114.084841, -113.409313, -112.746882, -112.092306, -111.447375, -110.806680 ]
#  x = [0.0, 1.0, 1.0, 0.0, 0.0, 1.0]
#  y = [0.0, 0.0, 1.0, 1.0, 2.0, 2.0]

x = [3, 2, 3, 3, 4, 4.8, 3, 6, 7, 8.3, 6.5, 7, 8, 9, 9, 3]
y = [0.5, 1, 2, 3, 2.5, 3.7, 5.5, 8, 9.5, 5.1, 4.2, 3, 2, 2, 3, 0.5]
points = [PointD(x[i], y[i]) for i in range(len(x))]

# Apply the smoothing functions
# You can adjust the parameters as needed
smoothed_points_catmull_rom = get_spline_interpolation_catmull_rom(points, 3)
smoothed_points_chaikin = get_curve_smoothing_chaikin(points, 0.5, 3)

# Extract smoothed data
smoothed_x_catmull_rom = [p.x for p in smoothed_points_catmull_rom]
smoothed_y_catmull_rom = [p.y for p in smoothed_points_catmull_rom]
smoothed_x_chaikin = [p.x for p in smoothed_points_chaikin]
smoothed_y_chaikin = [p.y for p in smoothed_points_chaikin]

# Now you can use smoothed_x_catmull_rom, smoothed_y_catmull_rom, smoothed_x_chaikin, and smoothed_y_chaikin for further processing
# Plotting the original data
plt.figure(figsize=(10, 6))
plt.plot(x, y, label='Original Data', color='blue', marker='o')

# Plotting the Catmull-Rom Spline smoothed data
plt.plot(smoothed_x_catmull_rom, smoothed_y_catmull_rom, label='Catmull-Rom Spline', color='red', linestyle='--')

# Plotting the Chaikin's algorithm smoothed data
plt.plot(smoothed_x_chaikin, smoothed_y_chaikin, label='Chaikin Smoothing', color='green', linestyle=':')

# Adding labels and title
plt.xlabel('X')
plt.ylabel('Y')
plt.title('Data Smoothing Comparison')
plt.legend()

# Show the plot
plt.show()


